<!-- 此文件用于处理，微信、qq中获取用户权限的场景 -->
<script>
// 根据当前页面中的search中的参数是否包含token决定当前页面是发起认证页面还是，认证回调页面
console.log('auth page search:' + window.location.search);
// 解析search，生成针对于search字符串的Object
var queryStr = window.location.search.split('?')[1] || '';
var queryParams = {}
queryStr.split('&').forEach(function (kvStr) {
  if (kvStr !== '') {
    var kvArr = kvStr.split('=');
    queryParams[kvArr[0]] = kvArr[1]
  }
});
// 判断参数中是否含有token
if (typeof queryParams.token === 'string' && queryParams.token !== '') {
  // 有token，调用回调函数
  console.log('got token from wq:' + queryParams.token);
  window.parent && typeof window.parent.jdAuthCallback === 'function' && window.parent.jdAuthCallback(null, queryParams.token);
} else {
  // 没有token信息，发起认证
  console.log('go to wq for token');
  var authUrl = encodeURIComponent('https://' + window.location.hostname + '/mobile/auth.html');
  window.location.href = 'https://wq.jd.com/pinbind/pinTokenRedirect?biz=jm-business-center&url=' + authUrl;
}
</script>